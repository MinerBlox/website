<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reps Central Console</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "primary-dark": "#111827",
            "primary-light": "#FFFFFF",
            accent: "#00AEEF",
            subtle: "#E5E7EB",
            "background-light": "#F8F8F8",
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
          },
        },
      },
    };
  </script>

  <style>
    body {
      background-color: var(--background-light, #f8f8f8);
      color: #4b5563;
    }

    .text-primary-dark {
      color: #111827 !important;
    }

    .card,
    .tiled-product-card {
      background-color: white !important;
      border-color: #e5e7eb !important;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -2px rgba(0, 0, 0, 0.06) !important;
      transition: all 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.1),
        0 5px 10px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-4px);
    }
    .border-subtle {
      border-color: #e5e7eb;
    }

    .header-gradient {
      background: linear-gradient(135deg, #ffffff 60%, #e0f7fa 100%);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.65rem;
      font-size: 0.75rem;
      font-weight: 600;
      border-radius: 9999px;
      background-size: 200% 100%;
      transition: background 0.5s ease;
      animation: subtle-shift-pill 4s linear infinite alternate;
    }

    @keyframes subtle-shift-pill {
      0% {
        background-position: 0% 50%;
      }
      100% {
        background-position: 100% 50%;
      }
    }

    .status-available {
      background-image: linear-gradient(90deg, #10b981, #00aeef);
      color: white;
      box-shadow: 0 1px 3px rgba(16, 185, 129, 0.4);
    }
    .status-dead {
      background-image: linear-gradient(90deg, #ef4444, #ec4899);
      color: white;
      box-shadow: 0 1px 3px rgba(239, 68, 68, 0.4);
    }
    .status-low-stock {
      background-image: linear-gradient(90deg, #f59e0b, #f97316);
      color: white;
      box-shadow: 0 1px 3px rgba(245, 158, 11, 0.4);
    }
    .status-checking {
      background-image: linear-gradient(90deg, #64748b, #475569);
      color: white;
      box-shadow: 0 1px 3px rgba(100, 116, 139, 0.4);
    }

    .home-nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: 700;
      transition: all 0.2s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .home-nav-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .auto-scroll-viewport {
      height: 500px;
      overflow: hidden;
      position: relative;
      mask-image: linear-gradient(
        to bottom,
        transparent 0%,
        black 5%,
        black 95%,
        transparent 100%
      );
      -webkit-mask-image: linear-gradient(
        to bottom,
        transparent 0%,
        black 5%,
        black 95%,
        transparent 100%
      );
      padding: 1rem 0;
    }

    .scrolling-content-wrapper {
      animation: autoScroll var(--scroll-duration, 15s) linear infinite;
      will-change: transform;
    }

    @keyframes autoScroll {
      0% {
        transform: translateY(0);
      }
      100% {
        transform: translateY(var(--scroll-distance, -1000px));
      }
    }

    @keyframes shake {
      10%,
      90% {
        transform: translate3d(-1px, 0, 0);
      }
      20%,
      80% {
        transform: translate3d(2px, 0, 0);
      }
      30%,
      50%,
      70% {
        transform: translate3d(-4px, 0, 0);
      }
      40%,
      60% {
        transform: translate3d(4px, 0, 0);
      }
    }
    .animate-shake {
      animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    }

    .glow-box {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border-radius: 0.75rem;
      color: white;
      text-align: center;
      font-weight: bold;
      font-size: 1.125rem;
      cursor: pointer;
      padding: 1.5rem;
    }
    .glow-box:hover {
      transform: translateY(-5px) scale(1.03);
    }
    .glow-box-blue {
      background-color: #3b82f6;
      box-shadow: 0 0 20px 5px rgba(59, 130, 246, 0.4);
    }
    .glow-box-blue:hover {
      box-shadow: 0 0 30px 10px rgba(59, 130, 246, 0.5);
    }
    .glow-box-red {
      background-color: #ef4444;
      box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.4);
    }
    .glow-box-red:hover {
      box-shadow: 0 0 30px 10px rgba(239, 68, 68, 0.5);
    }
    .glow-box-emerald {
      background-color: #10b981;
      box-shadow: 0 0 20px 5px rgba(16, 185, 129, 0.4);
    }
    .glow-box-emerald:hover {
      box-shadow: 0 0 30px 10px rgba(16, 185, 129, 0.5);
    }
    .glow-box-purple {
      background-color: #8b5cf6;
      box-shadow: 0 0 20px 5px rgba(139, 92, 246, 0.4);
    }
    .glow-box-purple:hover {
      box-shadow: 0 0 30px 10px rgba(139, 92, 246, 0.5);
    }
    .glow-box-amber {
      background-color: #f59e0b;
      box-shadow: 0 0 20px 5px rgba(245, 158, 11, 0.4);
    }
    .glow-box-amber:hover {
      box-shadow: 0 0 30px 10px rgba(245, 158, 11, 0.5);
    }
    .glow-box-slate {
      background-color: #64748b;
      box-shadow: 0 0 20px 5px rgba(100, 116, 139, 0.4);
    }
    .glow-box-slate:hover {
      box-shadow: 0 0 30px 10px rgba(100, 116, 139, 0.5);
    }
    .glow-box-orange-rec {
      background-color: #f97316;
      border: 2px solid #fb923c;
      box-shadow: 0 0 20px 8px rgba(251, 146, 60, 0.5);
    }
  
/* Trusted seller cards */
.trusted-seller-glow {
  position: relative;
  border-radius: 1rem;
  box-shadow: 0 0 0 0 rgba(0,0,0,0);
  transition: box-shadow 0.4s ease, transform 0.3s ease;
}
.trusted-seller-glow:hover {
  transform: translateY(-4px) scale(1.02);
}

.trusted-seller-card {
  position: relative;
  width: 100%;
  height: 260px;
  border-radius: 1rem;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.25s ease;
}
.trusted-seller-card:hover {
  transform: scale(1.02);
}

.trusted-seller-bg {
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  filter: blur(3px);
  transform: scale(1.1);
}

.trusted-seller-center-text {
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 2rem;
  font-weight: 800;
  color: white;
  text-shadow: 0 0 12px rgba(0,0,0,0.7);
}

/* Info panel that pops out below card on hover */
.trusted-seller-info-panel {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translate(-50%, 12px);
  width: 90%;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.35s ease, transform 0.35s ease;
}

.trusted-seller-info-inner {
  background: #ffffff;
  border-radius: 0 0 1rem 1rem;
  padding: 0.75rem 1rem;
  box-shadow: 0 18px 35px rgba(15,23,42,0.25);
  border-top: 1px solid rgba(148,163,184,0.65);
  font-size: 0.8rem;
  color: #111827;
}

.trusted-seller-info-title {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #6b7280;
  margin-bottom: 0.35rem;
  font-weight: 600;
}

.trusted-seller-info-row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 0.15rem;
  gap: 0.5rem;
}

.trusted-seller-info-row-label {
  font-weight: 500;
  color: #4b5563;
}

.trusted-seller-info-notes {
  margin-top: 0.25rem;
  font-size: 0.75rem;
  color: #4b5563;
}

.trusted-seller-glow:hover .trusted-seller-info-panel {
  opacity: 1;
  transform: translate(-50%, 0);
}


</style>
</head>
<body class="text-gray-800 font-sans min-h-screen p-4 sm:p-8">
  <!-- Sidebar -->
  <div
    id="sidebar"
    class="fixed top-0 left-0 h-full w-64 p-6 shadow-2xl transform -translate-x-full transition-transform duration-300 z-50 bg-white border-r border-subtle"
  >
    <div class="flex justify-between items-center mb-8">
      <h3 class="text-xl font-bold text-accent">Navigation</h3>
      <button
        onclick="toggleSidebar()"
        class="p-1 rounded-full text-gray-600 hover:bg-gray-100"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>

    <nav class="flex flex-col space-y-3">
      <button
        onclick="navigate('data')"
        class="text-left py-2 px-3 rounded-lg font-medium text-primary-dark hover:bg-gray-100 transition flex items-center"
      >
        <svg
          class="w-5 h-5 mr-3 text-accent"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10h2m-2 0h2m2 0V7m2 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"
          ></path>
        </svg>
        Go to Spreadsheet
      </button>
      <button
        onclick="navigate('link-converter')"
        class="text-left py-2 px-3 rounded-lg font-medium text-primary-dark hover:bg-gray-100 transition flex items-center"
      >
        <svg
          class="w-5 h-5 mr-3 text-accent"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 11.5V14m0-2.5v-2.5m0 5h2m0-5h2m0 0H9m7 0a4 4 0 00-4 4v2m0 0v2m0-4h2m-2 0h2m0 0h2m0 0h2"
          ></path>
        </svg>
        Link Converter
      </button>
      <button
        onclick="navigate('trusted-sellers')"
        class="text-left py-2 px-3 rounded-lg font-medium text-primary-dark hover:bg-gray-100 transition flex items-center"
      >
        <svg
          class="w-5 h-5 mr-3 text-accent"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12l2 2 4-4m5.618-4.104A9 9 0 0012 1m-1.765 1.765A9 9 0 003 12m18 0a9 9 0 01-9 9m-1.765-1.765A9 9 0 0121 12"
          ></path>
        </svg>
        Trusted Sellers
      </button>
      <button
        class="text-left py-2 px-3 rounded-lg font-medium text-primary-dark hover:bg-gray-100 transition flex items-center"
      >
        <svg
          class="w-5 h-5 mr-3 text-accent"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M14 10h4.764a2 2 0 011.857 2.193l-2.675 10.384A2 2 0 0118.427 22H5.573a2 2 0 01-1.936-2.533L5.836 12H10m-2 0V7A2 2 0 0110 5h4a2 2 0 012 2v5m-8 0h8"
          ></path>
        </svg>
        Socials
      </button>
    </nav>
  </div>

  <!-- Sidebar Backdrop -->
  <div
    id="sidebarBackdrop"
    onclick="toggleSidebar()"
    class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300 opacity-0"
  ></div>

  <!-- Main Container -->
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <header
      class="header-gradient flex justify-between items-center mb-6 pb-4 rounded-b-xl shadow-md px-4 sm:px-8 pt-4"
    >
      <div class="flex items-center space-x-3">
        <svg
          onclick="toggleSidebar()"
          class="w-8 h-8 text-accent cursor-pointer"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h7"
          ></path>
        </svg>
        <img
          src="https://raw.githubusercontent.com/MinerBlox/website/refs/heads/main/images/mainlogo.png"
          alt="Reps Central Logo"
          class="h-10 cursor-pointer"
          onclick="navigate('home')"
        />
      </div>
      <div class="w-5 h-5"></div>
    </header>

    <!-- HOME VIEW -->
    <div id="link-converter-view" class="py-10">
      <div class="max-w-2xl mx-auto">
        <h2 class="text-3xl font-bold text-primary-dark mb-4 text-center">
          Link Converter
        </h2>
        <p class="text-center text-gray-600 mb-8">
          A simple, sleek link converter with all your favourite agents.
        </p>

        <div
          class="card bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-100"
        >
          <div class="mb-6">
            <label
              for="linkInput"
              class="block text-sm font-medium text-gray-700 mb-2"
              >Original Link (any agent or source)</label
            >
            <div class="relative">
              <input
                type="url"
                id="linkInput"
                placeholder="Enter your link here..."
                class="w-full p-3 pl-10 border border-subtle rounded-xl
                       focus:ring-2 focus:ring-accent focus:border-accent
                       transition duration-300 shadow-sm
                       bg-gray-50 text-primary-dark"
              />
              <svg
                class="absolute left-3 top-1/2 -translate-y-1/2 transform w-5 h-5 text-gray-400 pointer-events-none"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                ></path>
              </svg>
            </div>
          </div>

          <button
            onclick="convertLink()"
            class="w-full home-nav-btn text-white bg-accent hover:bg-opacity-90 active:bg-opacity-100 shadow-lg shadow-accent/40 text-lg py-3 mb-6"
          >
            Convert Link
          </button>

          <div
            id="outputArea"
            class="hidden mt-6 space-y-6 transition-opacity duration-300 opacity-0"
          >
            <div id="resultsList" class="space-y-4"></div>
          </div>
          <p id="converterError" class="text-red-600 text-center mt-4 h-4"></p>
        </div>
      </div>
    </div>

    <!-- TRUSTED SELLERS VIEW -->
    
  </div>

  <script>

    // Sidebar toggling
    const sidebar = document.getElementById("sidebar");
    const sidebarBackdrop = document.getElementById("sidebarBackdrop");
    const body = document.body;
    let isSidebarOpen = false;

    function toggleSidebar() {
      isSidebarOpen = !isSidebarOpen;
      if (isSidebarOpen) {
        sidebar.classList.remove("-translate-x-full");
        sidebarBackdrop.classList.remove("hidden");
        setTimeout(() => sidebarBackdrop.classList.remove("opacity-0"), 10);
        body.classList.add("overflow-hidden");
      } else {
        sidebarBackdrop.classList.add("opacity-0");
        sidebar.classList.add("-translate-x-full");
        setTimeout(() => {
          sidebarBackdrop.classList.add("hidden");
          body.classList.remove("overflow-hidden");
        }, 300);
      }
    }

    // Navigate between the 4 standalone pages
    function navigate(page) {
      if (page === "home") {
        window.location.href = "index.html";
      } else if (page === "data") {
        window.location.href = "products.html";
      } else if (page === "link-converter") {
        window.location.href = "link-converter.html";
      } else if (page === "trusted-sellers") {
        window.location.href = "trusted-sellers.html";
      }
    }

    const universalLinkConverter = {
      taobao_id(url) {
        const q = new URL(url).searchParams;
        for (const k of ["id", "item_id", "default_item_id"]) {
          if (q.has(k) && q.get(k)) return q.get(k);
        }
        return null;
      },
      weidian_id(url) {
        const q = new URL(url).searchParams;
        if (q.has("itemID") && q.get("itemID")) return q.get("itemID");
        const m = url.match(/(?:itemID|id)=([0-9]{6,})/i);
        return m ? m[1] : null;
      },
      ali1688_id(url) {
        const m = url.match(/\/offer\/(\d+)\.html/);
        return m ? m[1] : null;
      },
      canonical_taobao_url: (id) =>
        `https://item.taobao.com/item.htm?id=${id}`,
      canonical_weidian_url: (id) =>
        `https://weidian.com/item.html?itemID=${id}`,
      canonical_1688_url: (id) =>
        `https://detail.1688.com/offer/${id}.html`,
      safe_unquote_twice(s) {
        try {
          return decodeURIComponent(decodeURIComponent(s));
        } catch (e) {
          try {
            return decodeURIComponent(s);
          } catch (e2) {
            return s;
          }
        }
      },
      extract_raw_from_wrapper(url) {
        const u = new URL(url);
        const q = u.searchParams;
        for (const key of ["url", "productLink", "link"]) {
          if (q.has(key) && q.get(key))
            return this.safe_unquote_twice(q.get(key));
        }
        if (u.hash) {
          const fragment = u.hash.substring(1);
          const fragmentPart = fragment.split("?")[1] || fragment;
          const fq = new URLSearchParams(fragmentPart);
          if (fq.has("productLink") && fq.get("productLink")) {
            return this.safe_unquote_twice(fq.get("productLink"));
          }
        }
        return null;
      },
      reverse_map_agent(url) {
        const host = new URL(url).hostname.toLowerCase();
        const q = new URL(url).searchParams;
        let m = url.match(/\/item-(micro-)?(1688-)?(\d+)\.html/);
        if (m) {
          if (m[1]) return ["weidian", m[3]];
          if (m[2]) return ["1688", m[3]];
          return ["taobao", m[3]];
        }
        m = url.match(/\/agent\/(taobao|weidian|1688)\/(\d+)\.html/);
        if (m) return [m[1], m[2]];
        if (q.has("id") && q.get("id")) {
          const plat = (
            q.get("platform") || q.get("shop_type") || ""
          ).toLowerCase();
          const _id = q.get("id");
          if (plat.includes("taobao")) return ["taobao", _id];
          if (plat.includes("weidian")) return ["weidian", _id];
          if (plat.includes("ali_1688") || plat.includes("1688"))
            return ["1688", _id];
          if (host.includes("acbuy.com")) {
            const src = (q.get("source") || "").toUpperCase();
            return [{ TB: "taobao", WD: "weidian", AL: "1688" }[src], _id];
          }
          if (host.includes("orientdig.com")) {
            const st = (q.get("shop_type") || "").toLowerCase();
            return [
              { taobao: "taobao", weidian: "weidian", ali_1688: "1688" }[st],
              _id,
            ];
          }
        }
        m =
          url.match(/\/products?\/(\d+)\/(\d+)/) ||
          url.match(/\/product\/(\d+)\/(\d+)/);
        if (m) {
          const tcode = parseInt(m[1]);
          const _id = m[2];
          let mapping = {};
          if (host.includes("ponybuy.com"))
            mapping = { 1: "taobao", 2: "1688", 3: "weidian" };
          else if (host.includes("usfans.com"))
            mapping = { 1: "1688", 2: "taobao", 3: "weidian" };
          else mapping = { 0: "1688", 1: "taobao", 2: "weidian" };
          return [mapping[tcode], _id];
        }
        if (host.includes("cnshopper.com") && q.has("keyword") && q.get("keyword")) {
          const plat = (q.get("platform") || "").toLowerCase();
          const _id = q.get("keyword");
          if (["taobao", "weidian", "1688"].includes(plat))
            return [plat, _id];
        }
        return [null, null];
      },
      _enc: (url) => encodeURIComponent(url),
      taobao_links(src_url) {
        const _id = this.taobao_id(src_url);
        if (!_id) throw new Error("Taobao id not found");
        const enc = this._enc(src_url);
        return {
          cnfans: `https://cnfans.com/product?id=${_id}&platform=TAOBAO`,
          mlubuy: `https://mlubuy.com/product?id=${_id}&platform=TAOBAO`,
          lovegobuy: `https://www.lovegobuy.com/product?id=${_id}&shop_type=taobao`,
          joygogo: `https://joyagoo.com/product?id=${_id}&platform=TAOBAO`,
          orientdig: `https://orientdig.com/product?shop_type=taobao&id=${_id}&ref=100201678`,
          acbuy: `https://www.acbuy.com/product?id=${_id}&source=TB`,
          hipobuy: `https://hipobuy.com/product/1/${_id}`,
          ponybuy: `https://www.ponybuy.com/products/1/${_id}`,
          hoobuy: `https://www.hoobuy.com/product/1/${_id}`,
          usfans: `https://www.usfans.com/product/2/${_id}`,
          cssbuy: `https://www.cssbuy.com/item-${_id}.html`,
          basetao: `https://www.basetao.com/best-taobao-agent-service/products/agent/taobao/${_id}.html`,
          kakobuy: `https://www.kakobuy.com/item/details?url=${enc}`,
          allchinabuy: `https://www.allchinabuy.com/en/page/buy?from=search-input&url=${enc}`,
          superbuy: `https://www.superbuy.com/en/page/buy?from=search-input&url=${enc}`,
          kameymall: `https://www.kameymall.com/purchases/search/item?url=${enc}`,
          eastmallbuy: `https://eastmallbuy.com/index/item/index.html?searchlang=en&url=${enc}`,
          hubbuycn: `https://www.hubbuycn.com/product/item?url=${enc}`,
          loonbuy: `https://www.loongbuy.com/product-details?url=${enc}`,
          itaobuy: `https://www.itaobuy.com/product-detail?url=${enc}`,
          sugargoo: `https://www.sugargoo.com/#/home/productDetail?productLink=${enc}`,
          cnshopper: `https://cnshopper.com/goods/detail?keyword=${_id}&platform=taobao`,
        };
      },
      weidian_links(src_url) {
        const _id = this.weidian_id(src_url);
        if (!_id) throw new Error("Weidian itemID not found");
        const enc = this._enc(src_url);
        return {
          cnfans: `https://cnfans.com/product?id=${_id}&platform=WEIDIAN`,
          mlubuy: `https://mlubuy.com/product?id=${_id}&platform=WEIDIAN`,
          joygogo: `https://joyagoo.com/product?id=${_id}&platform=WEIDIAN`,
          acbuy: `https://www.acbuy.com/product?id=${_id}&source=WD`,
          lovegobuy: `https://www.lovegobuy.com/product?id=${_id}&shop_type=weidian`,
          orientdig: `https://orientdig.com/product?shop_type=weidian&id=${_id}&ref=100201678`,
          hipobuy: `https://hipobuy.com/product/2/${_id}`,
          hoobuy: `https://www.hoobuy.com/product/2/${_id}`,
          ponybuy: `https://www.ponybuy.com/products/3/${_id}`,
          usfans: `https://www.usfans.com/product/3/${_id}`,
          oopbuy: `https://www.oopbuy.com/product/weidian/${_id}`,
          cssbuy: `https://www.cssbuy.com/item-micro-${_id}.html`,
          basetao: `https://www.basetao.com/best-taobao-agent-service/products/agent/weidian/${_id}.html`,
          kakobuy: `https://www.kakobuy.com/item/details?url=${enc}`,
          allchinabuy: `https://www.allchinabuy.com/en/page/buy?from=search-input&url=${enc}`,
          superbuy: `https://www.superbuy.com/en/page/buy?from=search-input&url=${enc}`,
          kameymall: `https://www.kameymall.com/purchases/search/item?url=${enc}`,
          eastmallbuy: `https://eastmallbuy.com/index/item/index.html?searchlang=en&url=${enc}`,
          hubbuycn: `https://www.hubbuycn.com/product/item?url=${enc}`,
          loonbuy: `https://www.loongbuy.com/product-details?url=${enc}`,
          itaobuy: `https://www.itaobuy.com/product-detail?url=${enc}`,
          sugargoo: `https://www.sugargoo.com/#/home/productDetail?productLink=${enc}`,
          cnshopper: `https://cnshopper.com/goods/detail?keyword=${_id}&platform=weidian`,
        };
      },
      a1688_links(src_url) {
        const _id = this.ali1688_id(src_url);
        if (!_id) throw new Error("1688 offer id not found");
        const enc = this._enc(src_url);
        return {
          cnfans: `https://cnfans.com/product?id=${_id}&platform=ALI_1688`,
          mlubuy: `https://mlubuy.com/product?id=${_id}&platform=ALI_1688`,
          lovegobuy: `https://www.lovegobuy.com/product?id=${_id}&shop_type=ali_1688`,
          joygogo: `https://joyagoo.com/product?id=${_id}&platform=ALI_1688`,
          orientdig: `https://orientdig.com/product?shop_type=ali_1688&id=${_id}&ref=100201678`,
          acbuy: `https://www.acbuy.com/product?id=${_id}&source=AL`,
          hipobuy: `https://hipobuy.com/product/0/${_id}`,
          hoobuy: `https://www.hoobuy.com/product/0/${_id}`,
          ponybuy: `https://www.ponybuy.com/products/2/${_id}`,
          oopbuy: `https://www.oopbuy.com/product/0/${_id}`,
          usfans: `https://www.usfans.com/product/1/${_id}`,
          cssbuy: `https://www.cssbuy.com/item-1688-${_id}.html`,
          basetao: `https://www.basetao.com/best-taobao-agent-service/products/agent/1688/${_id}.html`,
          kakobuy: `https://www.kakobuy.com/item/details?url=${enc}`,
          allchinabuy: `https://www.allchinabuy.com/en/page/buy?from=search-input&url=${enc}`,
          superbuy: `https://www.superbuy.com/en/page/buy?from=search-input&url=${enc}`,
          kameymall: `https://www.kameymall.com/purchases/search/item?url=${enc}`,
          eastmallbuy: `https://eastmallbuy.com/index/item/index.html?searchlang=en&url=${enc}`,
          hubbuycn: `https://www.hubbuycn.com/product/item?url=${enc}`,
          loonbuy: `https://www.loongbuy.com/product-details?url=${enc}`,
          itaobuy: `https://www.itaobuy.com/product-detail?url=${enc}`,
          sugargoo: `https://www.sugargoo.com/#/home/productDetail?productLink=${enc}`,
          cnshopper: `https://cnshopper.com/goods/detail?keyword=${_id}&platform=1688`,
        };
      },
      normalize_input(url) {
        const host = new URL(url).hostname.toLowerCase();
        if (
          ["taobao.com", "tmall.com", "tmall.hk"].some((h) =>
            host.includes(h)
          )
        ) {
          const _id = this.taobao_id(url);
          if (_id) return ["taobao", this.canonical_taobao_url(_id), _id];
        }
        if (host.includes("weidian.com")) {
          const _id = this.weidian_id(url);
          if (_id) return ["weidian", this.canonical_weidian_url(_id), _id];
        }
        if (host.includes("1688.com")) {
          const _id = this.ali1688_id(url);
          if (_id) return ["1688", this.canonical_1688_url(_id), _id];
        }
        const raw = this.extract_raw_from_wrapper(url);
        if (raw) return this.normalize_input(raw);
        const [src, _id] = this.reverse_map_agent(url);
        if (src === "taobao" && _id)
          return ["taobao", this.canonical_taobao_url(_id), _id];
        if (src === "weidian" && _id)
          return ["weidian", this.canonical_weidian_url(_id), _id];
        if (src === "1688" && _id)
          return ["1688", this.canonical_1688_url(_id), _id];
        throw new Error("Unsupported link format");
      },
      build_all_agents_from_any(url) {
        const [src, raw, _id] = this.normalize_input(url);
        if (src === "taobao") return this.taobao_links(raw);
        if (src === "weidian") return this.weidian_links(raw);
        if (src === "1688") return this.a1688_links(raw);
        throw new Error("Unreachable state");
      },
    };

    function convertLink() {
      const input = document.getElementById("linkInput");
      const outputArea = document.getElementById("outputArea");
      const resultsList = document.getElementById("resultsList");
      const errorDisplay = document.getElementById("converterError");

      resultsList.innerHTML = "";
      errorDisplay.textContent = "";

      const originalUrl = input.value.trim();
      if (originalUrl === "") {
        const inputContainer = input.parentElement;
        inputContainer.classList.add("animate-shake");
        setTimeout(
          () => inputContainer.classList.remove("animate-shake"),
          500
        );
        return;
      }

      try {
        const [src, rawUrl, id] =
          universalLinkConverter.normalize_input(originalUrl);
        const allLinks =
          universalLinkConverter.build_all_agents_from_any(originalUrl);

        const sourceLogos = {
          1688: "https://play-lh.googleusercontent.com/DwI4r890FbZU6dRagCSY-aNaiH4RFnGjJXKWt819ALj2rFt3Zi8WOgLhXBwXxAbw6P8oFFKh06dVJSyEQ857gg",
          weidian:
            "https://cdn.theorg.com/3d9532fe-09b4-47d1-92d8-a5d453e5c2b7_thumb.jpg",
          taobao:
            "https://cdn4.iconfinder.com/data/icons/chinas-social-share-icons/256/cssi_taobao-512.png",
        };
        const rawLogoUrl =
          sourceLogos[src] ||
          "https://placehold.co/40x40/cccccc/ffffff?text=?";

        const agentOrder = [
          { key: "cnfans", name: "CNFans" },
          { key: "mlubuy", name: "MuleBuy" },
          { key: "lovegobuy", name: "LoveGoBuy" },
          { key: "joygogo", name: "JoyaGoo" },
          { key: "orientdig", name: "OrientDig" },
          { key: "acbuy", name: "ACBuy" },
          { key: "hipobuy", name: "HippooBuy" },
          { key: "ponybuy", name: "PonyBuy" },
          { key: "hoobuy", name: "HooBuy" },
          { key: "usfans", name: "UsFans" },
          { key: "oopbuy", name: "OopBuy" },
          { key: "cssbuy", name: "CssBuy" },
          { key: "basetao", name: "BaseTao" },
          { key: "kakobuy", name: "KakoBuy" },
          { key: "allchinabuy", name: "AllChinaBuy" },
          { key: "superbuy", name: "SuperBuy" },
          { key: "kameymall", name: "KameyMall" },
          { key: "eastmallbuy", name: "EastMallBuy" },
          { key: "hubbuycn", name: "HubbuyCN" },
          { key: "loonbuy", name: "LoongBuy" },
          { key: "itaobuy", name: "iTaoBuy" },
          { key: "sugargoo", name: "Sugargoo" },
          { key: "cnshopper", name: "CNShopper" },
        ];

        const sourceDetails = document.getElementById("sourceDetails");
        sourceDetails.innerHTML = `
          <div class="flex items-center">
            <img src="${rawLogoUrl}" class="w-10 h-10 rounded-lg mr-3 object-cover" />
            <div>
              <p class="text-xs text-gray-500">Detected Source</p>
              <p class="text-sm font-semibold text-primary-dark uppercase">
                ${src || "Unknown"} &mdash; ID: ${id || "?"}
              </p>
            </div>
          </div>
        `;

        const recommendedAgentLink = allLinks["orientdig"];
        if (recommendedAgentLink) {
          const recHTML = `
            <div class="mb-4 p-3 rounded-lg bg-gray-50 border border-subtle flex items-center justify-between">
              <div class="flex flex-col">
                <span class="text-xs font-semibold text-gray-500">Recommended agent</span>
                <span class="text-sm text-primary-dark font-semibold">OrientDig</span>
              </div>
              <a href="${recommendedAgentLink}" target="_blank" rel="noopener noreferrer"
                class="inline-flex items-center px-3 py-1 rounded-full bg-accent text-xs font-semibold text-white">
                Open OrientDig
              </a>
            </div>
          `;
          resultsList.insertAdjacentHTML("beforeend", recHTML);
        }

        const agentContainer = document.createElement("div");
        agentContainer.className = "space-y-2";

        agentOrder.forEach((agentInfo) => {
          const link = allLinks[agentInfo.key];
          if (link) {
            const inputId = "output_" + agentInfo.key;
            const rowHTML = `
              <div class="flex items-center gap-3 mt-2">
                <span class="w-28 flex-shrink-0 font-medium text-gray-700 text-sm text-right">${agentInfo.name}:</span>
                <div class="relative flex-grow">
                  <input type="text" id="${inputId}" readonly value="${link}"
                    class="w-full p-2 pr-16 border border-gray-300 bg-gray-50 rounded-lg text-gray-800 font-mono text-xs shadow-inner focus:outline-none"/>
                  <button onclick="copyToClipboard('${inputId}', this)" 
                    class="absolute right-1 top-1/2 transform -translate-y-1/2 bg-gray-600 text-white text-xs font-bold py-1 px-3 rounded-md hover:bg-gray-700 transition">
                    Copy
                  </button>
                </div>
              </div>
            `;
            agentContainer.insertAdjacentHTML("beforeend", rowHTML);
          }
        });

        resultsList.appendChild(agentContainer);
        outputArea.classList.remove("hidden");
        setTimeout(() => outputArea.classList.remove("opacity-0"), 10);
      } catch (error) {
        console.error("Link conversion error:", error);
        errorDisplay.textContent =
          error.message || "Could not process the link.";
        const inputContainer = input.parentElement;
        input.classList.add(
          "border-red-500",
          "focus:border-red-500",
          "focus:ring-red-500"
        );
        inputContainer.classList.add("animate-shake");
        setTimeout(() => {
          inputContainer.classList.remove("animate-shake");
          input.classList.remove(
            "border-red-500",
            "focus:border-red-500",
            "focus:ring-red-500"
          );
        }, 1000);
      }
    }

    function copyToClipboard(inputId, buttonElement) {
      const outputInput = document.getElementById(inputId);
      const tempTextArea = document.createElement("textarea");
      tempTextArea.value = outputInput.value;
      document.body.appendChild(tempTextArea);
      tempTextArea.select();
      try {
        document.execCommand("copy");
        buttonElement.textContent = "Copied!";
        buttonElement.classList.remove("bg-gray-600", "hover:bg-gray-700");
        buttonElement.classList.add("bg-accent");
      } catch (err) {
        buttonElement.textContent = "Failed!";
        console.error("Fallback: Oops, unable to copy", err);
      }
      document.body.removeChild(tempTextArea);
      setTimeout(() => {
        buttonElement.textContent = "Copy";
        buttonElement.classList.add("bg-gray-600", "hover:bg-gray-700");
        buttonElement.classList.remove("bg-accent");
      }, 2000);
    }

    window.addEventListener("load", () => {
      const linkInput = document.getElementById("linkInput");
      const outputArea = document.getElementById("outputArea");
      if (linkInput && outputArea) {
        linkInput.addEventListener("input", () => {
          if (linkInput.value.trim() === "") {
            outputArea.classList.add("opacity-0");
            setTimeout(() => {
              outputArea.classList.add("hidden");
            }, 300);
          } else {
            outputArea.classList.remove("hidden");
          }
        });
      }
    });

  </script>

</body>
</html>
