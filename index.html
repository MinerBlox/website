<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type the Lyrics</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: #121212; /* Dark background */
            color: #fff; /* White text */
            overflow: auto;
        }
        #youtube-player-container {
            margin-top: 20px;
            position: relative;
            display: flex;
            justify-content: center;
            width: fit-content;
        }
        #youtube-player {
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Slightly darker shadow */
            width: 80vw;
            height: auto;
            aspect-ratio: 16 / 9;
            max-width: 800px;
        }
        #lyrics-container {
            z-index: 2;
            text-align: center;
            margin-top: 30px;
            padding: 10px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1); /* Slightly more transparent background */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Darker shadow */
            max-width: 95%;
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }
        #lyrics-container span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 25px;
            height: 25px;
            border-radius: 4px;
            background-color: #333; /* Darker grey background for letters */
            color: #ddd; /* Lighter grey text */
            font-size: 1.2em;
            margin: 2px;
            min-width: 25px;
            transition: color 0.2s ease; /* Smooth transition for color */
            cursor: pointer; /* Add a pointer cursor on hover */
        }
        #lyrics-container span:hover {
            background-color: #555; /* Slightly lighter on hover */
            color: #fff;
        }
        #lyrics-input {
            display: none; /* Hide the input box */
        }
        #feedback {
            margin-top: 10px;
            font-size: 1.1em;
            color: #aaa; /* Lighter text */
            min-height: 1.5em;
            text-align: center;
        }
        #accuracy {
            margin-top: 5px;
            font-size: 1em;
            color: #aaa;
            text-align: center;
        }
        #start-button {
            padding: 12px 24px;
            font-size: 1.2em;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            z-index: 3;
        }
        #start-button:hover {
            background-color: #0056b3;
        }
        #game-over-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            z-index: 4;
            display: none;
        }
        #game-over-content {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid #fff;
        }
        #game-over-content h2 {
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        #game-over-content p {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        #play-again-button {
            padding: 12px 24px;
            font-size: 1.2em;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 10px;
        }
        #play-again-button:hover {
            background-color: #0056b3;
        }
        @media (max-width: 768px) {
            #youtube-player-container {
                width: 95%;
                max-width: 560px;
            }
            #youtube-player {
                border-radius: 15px;
            }
            #lyrics-container {
                font-size: 0.9em;
            }
            #lyrics-container span {
                width: 20px;
                height: 20px;
                font-size: 0.9em;
            }
            #start-button {
                font-size: 1em;
                padding: 10px 20px;
            }
            #game-over-content h2 {
                font-size: 1.5em;
            }
            #game-over-content p {
                font-size: 1em;
            }
        }
        @media (max-width: 480px) {
            #youtube-player-container {
                width: 100%;
                top: 10px;
            }
            #youtube-player {
                border-radius: 10px;
                padding-bottom: 75%;
            }
            #lyrics-container {
                font-size: 0.7em;
                padding: 5px;
            }
            #lyrics-container span {
                width: 18px;
                height: 18px;
                font-size: 0.8em;
            }
            #feedback {
                font-size: 0.9em;
            }
            #start-button {
                font-size: 0.8em;
                padding: 8px 16px;
            }
            #game-over-content {
                padding: 15px;
            }
            #game-over-content h2 {
                font-size: 1.2em;
            }
            #game-over-content p {
                font-size: 0.9em;
            }
            #play-again-button {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div id="youtube-player-container">
        <div id="youtube-player"></div>
    </div>
    <div id="lyrics-container">
    </div>
    <input type="text" id="lyrics-input" placeholder="Start typing the lyrics...">
    <div id="feedback"></div>
    <div id="accuracy">Accuracy: 0%</div>
    <button id="start-button">Start Game</button>
    <div id="game-over-overlay">
        <div id="game-over-content">
            <h2>Game Over</h2>
            <p>Your Score: <span id="final-score">0</span></p>
            <button id="play-again-button">Play Again</button>
        </div>
    </div>
    <script>
        // --- YouTube Player ---
        let player;
        //const videoId = 'wTP2RUD_JjE';  // Use a direct video ID
        let videoId = '10';
        let playerReady = false;
        let gameStarted = false;
        let youtubeScriptLoaded = false;

        // This function is called when the YouTube API is ready.
        function onYouTubePlayerReady(event) {
            player = event.target;
            playerReady = true;
            // Start the video if the game has already started
            if (gameStarted) {
                player.playVideo();
            }
        }

        function loadYouTubeVideo(videoId) {
            if (!youtubeScriptLoaded) {
                // If the script is not loaded, load it and then load the video
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api'; // Corrected YouTube API URL
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                // Set a flag to indicate that the script has been loaded
                youtubeScriptLoaded = true;
            } else if (player && playerReady) {
                player.loadVideoById({
                    videoId: videoId,
                    suggestedQuality: 'hd720'
                });
                player.playVideo();
            } else if (player) {
                player.cueVideoById({
                    videoId: videoId,
                    suggestedQuality: 'hd720'
                });
            }
            //If player is not ready, the video will be loaded when player is ready.
        }

        // --- Lyrics Data ---
        // Updated Lyrics
        const lyrics = [
            "Hold me close 'til I get up",
            "Time is barely on our side",
            "I don't wanna waste what's left",
            "The storms we chase are leading us",
            "And love is all we'll ever trust, yeah",
            "No, I don't wanna waste what's left",
            "And on and on we'll go",
            "Through the wastelands, through the highways",
            "'Til my shadow turns to sun rays",
            "And on and on we'll go",
            "Through the wastelands, through the highways",
            "And on and on we'll go",
            "Oh, on we'll go",
            "Finding life along the way",
            "Melodies we haven't played",
            "No, I don't want no rest",
            "Echoin' around these walls",
            "Fighting to create a song (yeah)",
            "I don't wanna miss a beat",
            "And on and on we'll go",
            "Through the wastelands, through the highways",
            "'Til my shadow turns to sun rays",
            "And on and on we'll go",
            "Through the wastelands, through the highways",
            "And on and on we'll go",
            "And we'll grow in number",
            "Fueled by thunder, see the horizon",
            "Turn us to thousands",
            "And we'll grow in number",
            "Fueld by thunder, see the horizon",
            "Turn us to thousands",
            "And on and on we'll go",
            "Through the wastelands, through the highways",
            "'Til my shadow turns to sun rays",
            "And on and on we'll go",
            "Through the wastelands, through the highways",
            "And on and on we'll go"
        ];
        let currentLineIndex = 0;
        let correctChars = 0;
        let totalChars = 0;
        let startTime;
        let gameRunning = false;
        let score = 0;
        let currentLyricLine = ""; // To store the current line being displayed
        let userInput = "";
        const lyricsDisplay = document.getElementById('lyrics-container');
        const lyricsInput = document.getElementById('lyrics-input'); // Keep this, but hidden
        const feedback = document.getElementById('feedback');
        const accuracyDisplay = document.getElementById('accuracy');
        const startButton = document.getElementById('start-button');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const finalScoreDisplay = document.getElementById('final-score');
        const playAgainButton = document.getElementById('play-again-button');

        function displayLyricsLine(index) {
            if (index < lyrics.length) {
                currentLyricLine = lyrics[index];
                lyricsDisplay.innerHTML = '';
                userInput = ""; // Reset user input for each new line
                if (gameStarted) { // Only add spans if the game has started
                    for (let i = 0; i < currentLyricLine.length; i++) {
                        const span = document.createElement('span');
                        span.textContent = currentLyricLine[i];
                        lyricsDisplay.appendChild(span);
                    }
                }
                else{
                    lyricsDisplay.textContent = currentLyricLine;
                }
                lyricsInput.value = '';
                feedback.textContent = '';
                correctChars = 0;
                totalChars = 0;
                updateAccuracyDisplay();
            } else {
                endGame();
            }
        }

        function startGame() {
            if (!playerReady) {
                alert("Please wait for the video to load before starting the game.");
                return;
            }
            gameStarted = true;
            startButton.style.display = 'none';
            gameOverOverlay.style.display = 'none';
            currentLineIndex = 0;
            correctChars = 0;
            totalChars = 0;
            score = 0;
            startTime = new Date();
            displayLyricsLine(currentLineIndex);
            lyricsInput.focus();
            if (player) {
                player.playVideo(); // Start playing the video when the game starts
            }
            gameRunning = true;
            document.addEventListener('keydown', handleKeyDown); // Start listening for key presses
        }

        function handleKeyDown(event) {
            if (!gameRunning) return;
            const key = event.key.toLowerCase();
            if (key === 'backspace') {
                if (userInput.length > 0) {
                    userInput = userInput.slice(0, -1); // Remove the last character
                    const spans = lyricsDisplay.querySelectorAll('span');
                    if (userInput.length < currentLyricLine.length) {
                        spans[userInput.length].style.color = '#ddd'; // Default color
                    }

                }
            } else if (key.length === 1) {
                const expectedChar = currentLyricLine[userInput.length].toLowerCase();
                if (key === expectedChar) {
                    userInput += key;
                    correctChars++;
                    totalChars++;
                    const spans = lyricsDisplay.querySelectorAll('span');
                    spans[userInput.length - 1].style.color = 'green'; // Correct letter color
                    if (userInput.length === currentLyricLine.length) {
                        checkInput(); //check the input
                    }
                } else {
                    userInput += key;
                    totalChars++;
                    const spans = lyricsDisplay.querySelectorAll('span');
                    spans[userInput.length - 1].style.color = 'red'; // Incorrect letter color
                }
            }
            if (userInput.length < currentLyricLine.length) {
                const spans = lyricsDisplay.querySelectorAll('span');
                spans[userInput.length].style.color = 'white';
            }
            else if (userInput.length > currentLyricLine.length) {
                const spans = lyricsDisplay.querySelectorAll('span');
                spans[userInput.length - 1].style.color = 'red';
            }
            updateAccuracyDisplay();
        }

        function checkInput() {
            if (!gameRunning) return;
            if (userInput.length !== currentLyricLine.length)
                return;
            const currentLine = currentLyricLine.toLowerCase();
            if (userInput === currentLine) {
                correctChars += currentLine.length;
                totalChars += currentLine.length;
                currentLineIndex++;
                displayLyricsLine(currentLineIndex);
                feedback.textContent = 'Correct!';
                feedback.style.color = 'green';
                score += currentLine.length * 10;
                if (currentLineIndex >= lyrics.length) {
                    endGame();
                }
            } else {
                feedback.textContent = 'Incorrect!';
                feedback.style.color = 'red';
            }
            updateAccuracyDisplay();
        }

        function endGame() {
            gameRunning = false;
            if (player) {
                player.stopVideo();
            }
            const endTime = new Date();
            const timeTaken = (endTime.getTime() - startTime.getTime()) / 1000;
            let accuracy = totalChars > 0 ? (correctChars / totalChars) * 100 : 0;
            accuracy = Math.round(accuracy);
            if (timeTaken > 0) {
                score = Math.max(0, score - (timeTaken * 5));
            }
            score = Math.round(score * (accuracy / 100));
            finalScoreDisplay.textContent = score;
            gameOverOverlay.style.display = 'flex';
            startButton.style.display = 'none';
            document.removeEventListener('keydown', handleKeyDown); // Stop listening for key presses
        }

        function updateAccuracyDisplay() {
            let accuracy = totalChars > 0 ? (correctChars / totalChars) * 100 : 0;
            accuracy = Math.round(accuracy);
            accuracyDisplay.textContent = `Accuracy: ${accuracy}%`;
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        //lyricsInput.addEventListener('input', checkInput); // Remove this
        playAgainButton.addEventListener('click', startGame);

        // --- Initial Setup ---
        // Load the YouTube API script asynchronously
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api'; // Corrected YouTube API URL
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // onYouTubeIframeAPIReady is a required function, it's called by the API
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                events: {
                    'onReady': onYouTubePlayerReady,
                    'onError': onPlayerError
                },
                playerVars: {
                    'autoplay': 0,
                    'controls': 0,
                    'modestbranding': 1,
                    'rel': 0,
                    'showinfo': 0,
                    'iv_load_policy': 3
                }
            });
        }

        function onPlayerError(event) {
            console.error('YouTube Player Error:', event);
            // Handle the error as gracefully as possible.  For example:
            alert('An error occurred while loading the video. Please try again later.');
            // Optionally, you could try to load a different video or display a placeholder.
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING && !gameStarted) {
                player.pauseVideo();
            }
        }

        // Load video on page load,
        window.onload = function () {
            loadYouTubeAPI();
            // Check if the API is loaded
            if (typeof YT !== 'undefined' && YT.Player) {
                loadYouTubeVideo(videoId);
            } else {
                // If YT is not defined, try again when it is ready
                const intervalId = setInterval(() => {
                    if (typeof YT !== 'undefined' && YT.Player) {
                        loadYouTubeVideo(videoId);
                        clearInterval(intervalId);
                    }
                }, 100);
            }
        };
    </script>
</body>
</html>
